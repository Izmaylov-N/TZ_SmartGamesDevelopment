Тестовое задание (Lua, геймдев)

Необходимо реализовать небольшой прототип боевой системы без использования сторонних движков и готовых игровых библиотек.

Условие:
В игре есть юниты. У каждого:
- имя
- здоровье (hp)
- базовый урон (damage)
- шанс крита (crit_chance, 0-1)
- множитель крита (crit_mult)

Бой прохоидт пошагово:
- юниты атакуют друг друга по очереди
- при атаке урон может быть критическим
- если здоровье <= 0 - юнит выбывает
- бой продолжается, пока не останется один победитель

Нужно реализовать менеджер боя, который:
- принимает список юнитов
- запускает бой
- логирует события (кто кого ударил, урон, крит или нет, кто выбыл, кто победитель)

Дополнительные условия
1. Использовать ООП подход на Lua (таблицы + метатаблицы)
    - в решении обязательно должны быть отдельные сущности Unit и BattleManager
2. Нельзя использовать table.sort, table.insert и другие встроенные фунции для коллекций
    - нужно написать аналоги самостоятельно
3. В логах боя добавить простую визуализацую: например, рисовать полоску здоровья (####----) вместо чила hp
4. К решению приложить краткое описание архитектуры (1-2 абзаца):
    - какие классы есть
    - за что они отвечают 
    - как они взаимодействуют

Демонстрация
Сделать пример: 2-3 юнита сражаются до победы. Лог боя вывести в консоль.
Дополнительно (необязательно, но плюс)
- хранить лог в отдельной структуре и выводить его целиком в конце
- добавить новые типы юнитов (Mage, Tank и тд) через наследование